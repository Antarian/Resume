<ion-header>
    <app-top-toolbar pageTitle="Ionic 4 deployment to AWS with CICD"></app-top-toolbar>
</ion-header>

<ion-content class="ion-padding">
    <h1>Ionic 4/Angular deployment to AWS</h1>
    <p>This is step by step tutorial how to manage code deployment from GitHub to AWS for your Ionic 4 AngularJS PWA.</p>
    <p>For this tutorial you wil need AWS and GitHub accounts.</p>

    <h3>Step #1 - Required project changes</h3>
    <p>We will use new sample Ionic 4 app. But these steps are applicable to any Ionic 4 project.</p>
    <p>Instal Ionic 4 app</p>
    <pre><code>npm install -g ionic
ionic start ionicawscicd tabs</code></pre>
    <p>Run the app</p>
    <pre><code>cd ionicawscicd
ionic serve</code></pre>
    <p>This command will show you where your app is running. Usually it is <a target="_blank" href="http://localhost:8100">http://localhost:8100</a></p>
    <p>In a root folder of your Ionic 4 project put the file <code>buildspec.yml</code> defined by rules of AWS CodeBuild with this content:</p>
    <pre><code>version: 0.2

phases:
  install:
    runtime-versions:
      nodejs: 12
  pre_build:
    commands:
      - yarn install
  build:
    commands:
      - npm run build:prod
artifacts:
  files:
    - '**/*'
  base-directory: www</code></pre>
    <p>Explanation of phases</p>
    <ul>
        <li><strong>install</strong> - nodejs as runtime environment, as we are building Ionic 4/Angular 8 project</li>
        <li><strong>pre-build</strong> - yarn install to get all required dependencies for build</li>
        <li><strong>build</strong> - npm running build command, which is pointing to our <code>package.json</code> file</li>
    </ul>
    <p>Explanation of artifacts</p>
    <ul>
      <li><strong>files</strong> - types of files the build pipeline should use</li>
      <li><strong>base-directory</strong> - directory where build files can be found</li>
    </ul>

    <p>We will also alter <code>package.json</code> file to contain changes relevant for build</p>
    <pre><code>{{'{'}}
    "scripts": {{'{'}}
        <span>...,</span>
        "build:prod": "./node_modules/.bin/ionic build --prod"
    },
    <span>...,</span>
    "dependencies": {{'{'}}
        <span>...,</span>
        "ionic": "^5.4.10",
        <span>...</span>
    }
}</code></pre>
    <p>Explanation: <strong>build:prod</strong> is pointing to local Ionic CLI, which is added to <code>dependencies</code>.</p>
    <p></p>

    <h3>Step #2 - Creating GitHub project</h3>
    <p>Log to your GitHub account <a target="_blank" href="https://github.com/login">https://github.com/login</a>
        and create a new public repository named ionicawscicd
        <ion-img src=""></ion-img>
        <ion-img src=""></ion-img>
        From result save SSH or HTTPS link.
        <ion-img src=""></ion-img>
        You can now go to your project folder on your harddrive and setup it for git.
    </p>
    <pre><code>git init
        git add .
        git commit -m"project first commit"</code></pre>
    <p>This step will be little different for everyone. It depends on name of your repository and if you already setup
        SSH key for GitHub. You can use ssh link of repository like me or https.</p>
    <pre><code>git remote add origin git@github.com:Antarian/ionicawscicd.git
git push -u origin master</code></pre>
    <p>Now if you refresh github page (mine is <a target="_blank" href="https://github.com/Antarian/ionicawscicd">https://github.com/Antarian/ionicawscicd</a>)
        you should see Ionic project codebase
        <ion-img src=""></ion-img>
    </p>

    <h3>Step #3 - Creating AWS S3 bucket</h3>
    <p>Go to your AWS console account and access Amazon S3 home page.
        <a target="_blank" href="https://console.aws.amazon.com/s3/home">Amazon S3 </a>
        and start creating new bucket by hitting button "+ Create bucket"
        <ion-img src=""></ion-img>
    </p>
    <p>Enter DNS compliant bucket name and select region. I will name it <code>ionicawscicd</code> and my closest region is EU (London).
        <ion-img src=""></ion-img>
       Let all other steps on default for now. We may change them later.
    </p>
    <p>Your bucket should be now created.</p>
        <ion-img src=""></ion-img>
    <p>and we can continue to next step.</p>

    <h3>Step #3 - Creating CodePipeline</h3>
    <p>On the page <a href="https://console.aws.amazon.com/codesuite/codepipeline/pipelines">https://console.aws.amazon.com/codesuite/codepipeline/pipelines</a>
        change region in right top corner to the one where you are deploying app. For me it is EU London.
        <ion-img src=""></ion-img>
        Next hit the button Create pipeline.
        <ion-img src=""></ion-img>
        I named the pipeline <code>ionicawscicd-pipeline</code> and hit button "next".
        <ion-img src=""></ion-img>
        As a source select "GitHub" and then hit connect button. If you were logout, than login to GitHub again in
        the window provided by AWS CodePipeline. Select your ionicawscicd repository and branch master.
        <ion-img src=""></ion-img>
        As a build provider select AWS CodeBuild and hit Create project button.
        Name it <code>ionicawscicd-build</code> Select Managed image, Operating system Ubuntu, runtime Standard,
        Image standard:3.0, Image version Always use the lastest, Environment type Linux.
        Check New service role and using of BuildSpec file.
        <ion-img src=""></ion-img>
        <ion-img src=""></ion-img>
        <ion-img src=""></ion-img>
        <ion-img src=""></ion-img>

        Select Amazon S3 and our earlier created S3 bucket.
        <ion-img src=""></ion-img>
    </p>

    <h3>Step #4 - Publishing website with CloudFront</h3>
    <p>On <a href="https://console.aws.amazon.com/cloudfront/home">https://console.aws.amazon.com/cloudfront/home</a>
        we will create new distribution.
        <ion-img src=""></ion-img>
        Select the web
        <ion-img src=""></ion-img>
        As origin domain name select our s3 bucket domain. Should be something similar
        to ionicawscicd.s3.amazonaws.com.

    </p>
</ion-content>
